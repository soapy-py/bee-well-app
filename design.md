Backend Design (Natural Language Processing, Flask, SQL, etc.)

The core Natural Language Processing (NLP) component in this website involves calling on a Hugging Face API for the Roberta-base-go_emotions model. Roberta-base-go_emotions is an open-source NLP model based on RoBERTa architecture. It is fine-tuned on the go_emotions dataset for multi-label emotion classification from text. The go_emotions dataset is based on Reddit data and has 28 emotion labels, where one or multiple labels may apply for any given input text. Typically a threshold of 0.5 is applied to the probabilities for the prediction for each label, where emotions with a probability above 0.5 are considered relevant. The 28 possible emotions are admiration amusement anger annoyance approval caring confusion curiosity desire disappointment disapproval disgust embarrassment excitement fear gratitude grief joy love nervousness optimism pride realization relief remorse sadness surprise neutral. The highlighted colors indicate the emotional aura they correspond to. Inspired by the Spotify Audio Aura we learned about in CS50’s Problem Set 7, we decided to assign a corresponding aura for each journal entry based on its highest percentage mood. This is helpful in connecting the user to the mental resources page where there are recommended songs under each color.

When a user submits a journal entry from our website, the input text is sent as a JSON payload to the Hugging Face API using the requests library. An API is an Application Programming Interface which is a set of tools that help software applications communicate with each other. APIs define the structure of requests and responses for different systems to exchange data efficiently. The API processes the text and returns an analysis containing the probabilistic mapping of the input to all 28 emotional categories (e.g., happiness, sadness, anger, etc.). This response is stored into a SQL database called journal.db so it can be displayed on the website later on. Within journal.db, the responses are found in a table called journalentries includes id, user_id, title, text, analysis, and timestamp. 
To develop our website and integrate our Hugging Face API, we used Flask, HTML, Javascript, and CSS. In terms of backend, Flask is a lightweight and flexible web framework for Python that serves as the backbone of our website, connecting the user interface, the NLP model, and the database. Flask handles routing and defines how our application responds to specific URLs based on user actions such as submitting a journal entry or viewing past entries. Flask acts as an intermediary between the front end and the Hugging Face NLP model by receiving user input, sending it to the API for analysis, and processing the response. The results, such as emotional analysis, are then stored in the database using SQL commands, making them accessible for later retrieval. 
Flask also manages user authentication and sessions, ensuring that only logged-in users can access their data. User information is stored in the journal.db database in a table called users which includes columns for id, username, firstname, lastname, and hash (the hash for the user’s password generated by the werkzeug API). We adapted and modified code from our CS50 Finance assignment to create functions to register, login, and logout users, as well as to generate error pages. Then, to further improve the error-handling process and make our code’s design more efficient, we utilized a helper function called get_form, which retrieves information from some form and returns an error message if the information is missing/invalid.
Frontend Design (HTML, CSS, Bootstrap etc.)
Flask's flexibility provided seamless communication between frontend and backend, making it ideal for building this web application where user interaction and data processing work together. In terms of frontend, we leveraged Flask’s ability to dynamically render web pages to populate our web pages with data from the database and NLP analysis. 
Because our model returns its emotion classification results in the form of a string representing a dictionary (i.e. [[{'label': 'disappointment', 'score': 0.4311619699001312}]]), we needed to first create a helper_function to extract the three most prominent moods found in the journal entry before passing our NLP results to our HTML, in order to provide easier user interpretation. Specifically, in our function extract_top_moods, we parsed the string into a list of dictionaries using the json.load method, such that each dictionary in the list represented a journal entry, with key “label” (mood label) and “score”. From there, we were able to extract the moods with the top three scores and pass them to our HTML, so our webpage could then reflect these results. To assist with color coding our website, we wrote a helper function called get_color, which takes in a mood (in the form of a string) and returns its representative color. 
Javascript was briefly used to animate the illusion of text being typed across the website as a page was loaded. We used 
Finally, in terms of the UI of our website, we utilized Bootstrap to create cards to display our journal entries, as well as to create the input forms for our journal. 
Challenges encountered:

Extracting the journal entries we want to conduct NLP analysis on. This required us to modify the journalentries and users SQL databases so that both contain a user_id column. This could help us join the databases and extract a journal entry from the specific user for analysis.
Posting the journal entries to the NLP website. Through research, we decided to leverage the requests library and learned how to include the API_URL, headers (which is the API key we created on hugging face), and json payload. The key was to post the journal entry in JSON format instead of the regular string format from the user so that the NLP model could properly accept the input for analysis and return a JSON output.
Mapping the top mood for each journal entry to an aura color. We wanted to enhance the visual representation of each journal entry and help them identify which songs on the mental resources playlist best help with their current mood. Initially, we were unsure how to best visually reflect users’ moods, but ultimately decided color-coordinating our journal entries would be most effective and appealing. We mapped moods to colors based on the colors from Inside Out, which are more related to moods than the Spotify Aura categories that focus on vibes. For example, entries predominantly tagged with "joy" might be displayed with a warm yellow color, while entries with "anger" are displayed with red. 
